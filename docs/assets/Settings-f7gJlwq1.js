import{d as z,u as G,o as H,c as i,a as t,w as j,v as w,i as E,F as Q,e as W,f as p,t as N,r as o,g as X,h as d,_ as Y}from"./index-BT5ZBQFZ.js";const Z={class:"settings"},tt={class:"settings-container"},et={class:"setting-item"},st={class:"reminder-setting"},nt={class:"setting-item"},ot={class:"subject-management"},lt={class:"add-subject"},at={class:"subjects-list"},it={key:0,class:"empty-state"},dt={class:"subject-name"},ut={class:"subject-actions"},ct=["onClick"],rt=["onClick"],vt={class:"setting-item"},mt={class:"notification-setting"},pt={key:1,class:"permission-status granted"},ft={key:2,class:"permission-status denied"},bt={class:"setting-item"},gt={key:0,class:"modal"},_t={class:"modal-content"},kt={key:1,class:"modal"},yt={class:"modal-content"},St={class:"modal-message"},Ct={key:2,class:"modal"},ht={key:3,class:"modal"},jt={class:"modal-content toast"},wt={class:"toast-message"},Nt=z({__name:"Settings",setup(Dt){const l=G(),f=o(60),r=o("default"),v=o(""),b=o(null),c=o(""),D=o(null),k=o(!1),y=o(!1),S=o(!1),C=o(!1),I=o(""),g=o(""),h=o(""),M=X(()=>l.subjects),R=()=>{l.setReminderInterval(f.value),a("设置已保存")},L=()=>{"Notification"in window&&Notification.requestPermission().then(n=>{r.value=n,a("通知权限已更新")})},x=()=>{v.value.trim()&&(l.addSubject(v.value.trim()),a("科目添加成功"),v.value="")},B=n=>{b.value=n,c.value=n.name,k.value=!0},T=()=>{c.value.trim()&&b.value&&(l.updateSubject(b.value.id,c.value.trim()),a("科目更新成功"),O())},O=()=>{k.value=!1,b.value=null,c.value=""},F=(n,e)=>{g.value=n,h.value=e,y.value=!0},J=()=>{g.value&&(l.removeSubject(g.value),a("科目删除成功"),U())},U=()=>{y.value=!1,g.value="",h.value=""},A=()=>{S.value=!0},K=()=>{localStorage.removeItem("studySessions"),l.sessions=[],a("数据已清除"),V()},V=()=>{S.value=!1},P=()=>{const n=JSON.stringify(l.sessions,null,2),e=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(e),u=document.createElement("a");u.href=s,u.download=`study-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(s),a("数据导出成功")},$=()=>{D.value?.click()},q=n=>{const e=n.target.files[0];if(!e)return;const s=new FileReader;s.onload=u=>{try{const _=JSON.parse(u.target?.result);Array.isArray(_)&&_.every(m=>m.id&&m.startTime&&m.endTime&&m.duration&&m.date)?confirm("确定要导入数据吗？这将覆盖当前的学习记录。")&&(l.sessions=_,l.saveSessions(),a("数据导入成功！")):a("无效的数据文件格式")}catch{a("数据文件解析失败")}},s.readAsText(e),n.target.value=""},a=n=>{I.value=n,C.value=!0,setTimeout(()=>{C.value=!1},2e3)};return H(()=>{l.loadSettings(),l.loadSubjects(),f.value=l.reminderInterval,"Notification"in window&&(r.value=Notification.permission)}),(n,e)=>(d(),i("div",Z,[e[16]||(e[16]=t("h1",null,"设置",-1)),t("div",tt,[t("div",et,[e[4]||(e[4]=t("h2",null,"休息提醒设置",-1)),t("div",st,[e[3]||(e[3]=t("label",{for:"reminderInterval"},"提醒间隔（分钟）：",-1)),j(t("input",{type:"number",id:"reminderInterval","onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),min:"1",max:"120"},null,512),[[w,f.value,void 0,{number:!0}]]),t("button",{onClick:R},"保存设置")]),e[5]||(e[5]=t("p",{class:"setting-description"}," 当学习时长达到设定的分钟数时，系统会发送休息提醒通知 ",-1))]),t("div",nt,[e[6]||(e[6]=t("h2",null,"科目管理",-1)),t("div",ot,[t("div",lt,[j(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),placeholder:"输入新科目名称",onKeyup:E(x,["enter"])},null,544),[[w,v.value]]),t("button",{onClick:x},"添加科目")]),t("div",at,[M.value.length===0?(d(),i("div",it," 暂无科目，请添加 ")):(d(!0),i(Q,{key:1},W(M.value,s=>(d(),i("div",{class:"subject-item",key:s.id},[t("span",dt,N(s.name),1),t("div",ut,[t("button",{onClick:u=>B(s),class:"edit"},"编辑",8,ct),t("button",{onClick:u=>F(s.id,s.name),class:"danger"},"删除",8,rt)])]))),128))])]),e[7]||(e[7]=t("p",{class:"setting-description"}," 管理您的学习科目，添加新科目或编辑现有科目 ",-1))]),t("div",vt,[e[8]||(e[8]=t("h2",null,"通知权限",-1)),t("div",mt,[r.value==="default"?(d(),i("button",{key:0,onClick:L}," 请求通知权限 ")):r.value==="granted"?(d(),i("span",pt," 通知权限已授予 ")):r.value==="denied"?(d(),i("span",ft," 通知权限已拒绝 ")):p("",!0)]),e[9]||(e[9]=t("p",{class:"setting-description"}," 请授予通知权限以接收休息提醒 ",-1))]),t("div",bt,[e[10]||(e[10]=t("h2",null,"数据管理",-1)),t("div",{class:"data-setting"},[t("button",{onClick:P},"导出数据"),t("button",{onClick:$},"导入数据"),t("button",{onClick:A,class:"danger"},"清除数据")]),e[11]||(e[11]=t("p",{class:"setting-description"}," 导出数据将生成一个包含所有学习记录的JSON文件，导入数据将从JSON文件恢复学习记录 ",-1)),t("input",{type:"file",id:"fileInput",ref_key:"fileInput",ref:D,style:{display:"none"},accept:".json",onChange:q},null,544)])]),k.value?(d(),i("div",gt,[t("div",_t,[e[12]||(e[12]=t("h3",null,"编辑科目",-1)),j(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s),placeholder:"输入科目名称",onKeyup:E(T,["enter"])},null,544),[[w,c.value]]),t("div",{class:"modal-buttons"},[t("button",{onClick:T},"确定"),t("button",{onClick:O},"取消")])])])):p("",!0),y.value?(d(),i("div",kt,[t("div",yt,[e[13]||(e[13]=t("h3",null,"确认删除",-1)),t("p",St,'确定要删除科目 "'+N(h.value)+'" 吗？此操作不可恢复。',1),t("div",{class:"modal-buttons"},[t("button",{onClick:J,class:"danger"},"删除"),t("button",{onClick:U},"取消")])])])):p("",!0),S.value?(d(),i("div",Ct,[t("div",{class:"modal-content"},[e[14]||(e[14]=t("h3",null,"确认清除数据",-1)),e[15]||(e[15]=t("p",{class:"modal-message"},"确定要清除所有学习数据吗？此操作不可恢复。",-1)),t("div",{class:"modal-buttons"},[t("button",{onClick:K,class:"danger"},"清除数据"),t("button",{onClick:V},"取消")])])])):p("",!0),C.value?(d(),i("div",ht,[t("div",jt,[t("p",wt,N(I.value),1)])])):p("",!0)]))}}),xt=Y(Nt,[["__scopeId","data-v-76de2b5f"]]);export{xt as default};

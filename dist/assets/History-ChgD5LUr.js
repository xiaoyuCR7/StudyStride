import{d as K,u as P,r as d,o as Q,c as a,a as e,w as p,v as D,b as B,F as C,e as M,t as u,f as x,g as h,h as l,_ as R}from"./index-DQtV_mCF.js";const W={class:"history"},X={class:"history-container"},Z={class:"filters"},tt={class:"date-filter"},et={class:"subject-filter"},st=["value"],ot={class:"stats-container"},nt={class:"stats-grid"},at={class:"stat-item"},lt={class:"stat-value"},it={class:"stat-item"},dt={class:"stat-value"},ut={class:"stat-item"},rt={class:"stat-value"},ct={class:"sessions-list"},vt={key:0,class:"empty-state"},mt={class:"session-header"},pt={class:"session-time"},_t={class:"start-time"},ft={class:"duration"},bt={class:"session-actions"},ht={class:"session-subject"},St={class:"subject-tag"},gt=["onClick"],Dt=["onClick"],yt={key:0,class:"session-content"},kt={key:1,class:"session-content empty"},wt={key:2,class:"modal"},Tt={class:"modal-content"},jt={class:"form-group"},Ct=["value"],Mt={class:"form-group"},xt={class:"duration-inputs"},Vt={class:"form-group"},It={key:3,class:"modal"},Ft={key:4,class:"modal"},Ut={class:"modal-content toast"},Bt={class:"toast-message"},Et=K({__name:"History",setup(Ht){const n=P(),c=d(new Date().toISOString().split("T")[0]),_=d(""),y=d([]),k=d(!1),r=d({id:"",subject:"",content:"",duration:0}),f=d(0),b=d(0),w=d(!1),S=d(""),T=d(!1),V=d(""),E=h(()=>(c.value?new Date(c.value):new Date).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})),I=h(()=>n.subjects),H=h(()=>{const o=new Date,t=new Date(o);t.setDate(o.getDate()-o.getDay()),t.setHours(0,0,0,0);const s=t.toISOString().split("T")[0];return n.sessions.filter(i=>i.date>=s).reduce((i,m)=>i+m.duration,0)}),N=h(()=>{const o=new Date,s=new Date(o.getFullYear(),o.getMonth(),1).toISOString().split("T")[0];return n.sessions.filter(i=>i.date>=s).reduce((i,m)=>i+m.duration,0)}),O=h(()=>n.sessions.reduce((o,t)=>o+t.duration,0)),v=()=>{let o=n.sessions;c.value&&(o=o.filter(t=>t.date===c.value)),_.value&&(o=o.filter(t=>t.subject===_.value)),y.value=o},$=()=>{v()},L=()=>{v()},z=()=>{c.value="",_.value="",v()},A=o=>new Date(o).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),g=o=>{const t=Math.floor(o/3600),s=Math.floor(o%3600/60);return`${t}小时${s}分钟`},Y=o=>{S.value=o,w.value=!0},q=()=>{S.value&&(n.sessions=n.sessions.filter(o=>o.id!==S.value),n.saveSessions(),v(),j("学习记录已删除"),F())},F=()=>{w.value=!1,S.value=""},G=o=>{r.value={id:o.id,subject:o.subject,content:o.content,duration:o.duration},f.value=Math.floor(o.duration/3600),b.value=Math.floor(o.duration%3600/60),k.value=!0},J=()=>{const o=f.value*3600+b.value*60;if(o===0){j("请输入有效的学习时长");return}const t=n.sessions.findIndex(s=>s.id===r.value.id);if(t!==-1){const s=n.sessions[t];if(s){const i=s.endTime?new Date(s.endTime):new Date,m=new Date(i.getTime()-o*1e3);n.sessions[t]={...s,id:s.id,subject:r.value.subject,content:r.value.content,duration:o,startTime:m,endTime:i,date:s.date||m.toISOString().split("T")[0]},n.saveSessions(),v(),U(),j("学习记录已更新成功")}}},U=()=>{k.value=!1,r.value={id:"",subject:"",content:"",duration:0},f.value=0,b.value=0},j=o=>{V.value=o,T.value=!0,setTimeout(()=>{T.value=!1},2e3)};return Q(()=>{n.loadSessions(),n.loadSubjects(),v()}),(o,t)=>(l(),a("div",W,[t[19]||(t[19]=e("h1",null,"学习历史",-1)),e("div",X,[e("div",Z,[e("div",tt,[p(e("input",{type:"date","onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),onChange:$},null,544),[[D,c.value]]),e("button",{onClick:z},"显示全部")]),e("div",et,[t[7]||(t[7]=e("label",{for:"subjectFilter"},"按科目筛选：",-1)),p(e("select",{id:"subjectFilter","onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),onChange:L},[t[6]||(t[6]=e("option",{value:""},"-- 全部科目 --",-1)),(l(!0),a(C,null,M(I.value,s=>(l(),a("option",{key:s.id,value:s.name},u(s.name),9,st))),128))],544),[[B,_.value]])])]),e("div",ot,[t[11]||(t[11]=e("h2",null,"学习时长统计",-1)),e("div",nt,[e("div",at,[t[8]||(t[8]=e("h3",null,"本周",-1)),e("p",lt,u(g(H.value)),1)]),e("div",it,[t[9]||(t[9]=e("h3",null,"本月",-1)),e("p",dt,u(g(N.value)),1)]),e("div",ut,[t[10]||(t[10]=e("h3",null,"总计",-1)),e("p",rt,u(g(O.value)),1)])])]),e("div",ct,[e("h2",null,u(E.value)+" 的学习记录",1),y.value.length===0?(l(),a("div",vt," 暂无学习记录 ")):(l(!0),a(C,{key:1},M(y.value,s=>(l(),a("div",{class:"session-item",key:s.id},[e("div",mt,[e("div",pt,[e("span",_t,u(A(s.startTime)),1),e("span",ft,u(g(s.duration)),1)]),e("div",bt,[e("div",ht,[e("span",St,u(s.subject||"未分类"),1)]),e("button",{onClick:i=>G(s),class:"edit-btn"},"编辑",8,gt),e("button",{onClick:i=>Y(s.id),class:"delete-btn"},"删除",8,Dt)])]),s.content?(l(),a("div",yt,u(s.content),1)):(l(),a("div",kt," 未记录学习内容 "))]))),128)),k.value?(l(),a("div",wt,[e("div",Tt,[t[16]||(t[16]=e("h3",null,"编辑学习记录",-1)),e("div",jt,[t[12]||(t[12]=e("label",{for:"editSubject"},"科目：",-1)),p(e("select",{id:"editSubject","onUpdate:modelValue":t[2]||(t[2]=s=>r.value.subject=s)},[(l(!0),a(C,null,M(I.value,s=>(l(),a("option",{key:s.id,value:s.name},u(s.name),9,Ct))),128))],512),[[B,r.value.subject]])]),e("div",Mt,[t[14]||(t[14]=e("label",{for:"editDuration"},"时长：",-1)),e("div",xt,[p(e("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),min:"0",placeholder:"小时"},null,512),[[D,f.value,void 0,{number:!0}]]),t[13]||(t[13]=e("span",{class:"separator"},":",-1)),p(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=s=>b.value=s),min:"0",max:"59",placeholder:"分钟"},null,512),[[D,b.value,void 0,{number:!0}]])])]),e("div",Vt,[t[15]||(t[15]=e("label",{for:"editContent"},"内容：",-1)),p(e("textarea",{id:"editContent","onUpdate:modelValue":t[5]||(t[5]=s=>r.value.content=s),placeholder:"学习内容..."},null,512),[[D,r.value.content]])]),e("div",{class:"modal-buttons"},[e("button",{onClick:J},"保存"),e("button",{onClick:U},"取消")])])])):x("",!0),w.value?(l(),a("div",It,[e("div",{class:"modal-content"},[t[17]||(t[17]=e("h3",null,"确认删除",-1)),t[18]||(t[18]=e("p",{class:"modal-message"},"确定要删除这条学习记录吗？此操作不可恢复。",-1)),e("div",{class:"modal-buttons"},[e("button",{onClick:q,class:"danger"},"删除"),e("button",{onClick:F},"取消")])])])):x("",!0),T.value?(l(),a("div",Ft,[e("div",Ut,[e("p",Bt,u(V.value),1)])])):x("",!0)])])]))}}),Ot=R(Et,[["__scopeId","data-v-75f8955d"]]);export{Ot as default};
